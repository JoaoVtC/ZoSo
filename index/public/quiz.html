<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
     <link rel="stylesheet" href="./css/quiz.css">
</head>
<body>
    <div class="header" id="header">
    <a href="#header"><img src="assets/logo.png" alt="" width="250px" height="110px"></a>
    <h2 class="button-header"><a href="#historia">História</a></h2>
    <h2 class="button-header"><a href="#integrante">Integrantes</a></h2>
    <h2 class="button-header"><a href="#album">Álbuns</a></h2>
    <h2 class="button-header"><a href="">Quiz</a></h2>
    <h2 class="button-header"><a href="cadastro.html">Cadastro</a></h2>
    <h2><a class="button-header" href="login.html">Login</a></h2>
  </div>

  <div class="container-middle">
    <div class="songs-container">
        <span class="box-red">
            <h2>Como jogar?</h2>
        </span>
    </div>

    <div class="play-container">
        <h1>Advinhe a música</h1>
        <div class="answer-box">
            <div class="try-box">
                <span class="try"></span>
                <span class="try"></span>
                <span class="try"></span>
                <span class="try"></span>
                <span class="try"></span>
            </div>
            <img src="assets/question.png" alt="https://www.pngwing.com/pt/free-png-baaoe" class="question-img" id="imgMusica">
        </div>
        <div id="nomeMusica" style="margin-left: 40px;"></div>
        <input type="text" placeholder="digíte aqui..." id="iptResposta">
        <div class="buttons-box">
            <button onclick="pularSegundos()" style="background-color: black; border: 2px white solid;">Pular</button>
            <button onclick="advinhar()" style="background-color: black; border: 2px white solid;">Confirmar</button>
            <button onclick="finalizar()"  style="background-color: red; border: inherit;">Finalizar tentativa</button>
        </div>
    </div>

    <div class="howTo-container">
    </div>
  </div>
  <div class="container-bottom">
     <input type="range" value="0" id="progress">
    <audio controls id="song">
        <source src="assets/audios/HowManyMoreTimes10s.mp3" id="audioSong">
    </audio>
    <div class="play-box" onclick="iniciar()">
        <img src="assets/play-solid.svg" alt="" width="30px" height="55px" id="cntrlIcon">
    </div>
    
  </div>
</body>
<script>

    var vtMusicas = [["How Many More Times", "assets/led_I.jpg", "assets/audios/HowManyMoreTimes10s.mp3"], 
    ["I Can't Quit You Baby", "assets/led_I.jpg", "assets/audios/ICantQuitYouBaby10s.mp3"], 
    ["Heartbreaker", "assets/led_2.jpg", "assets/audios/Heartbreaker10s.mp3"]];
    var resposta = false;
    var listened = false
    var tentativas = -1;
    var vtTentativas = [0,0,0,0,0]
    var progress = document.getElementById("progress")
    var song = document.getElementById("song")
    var cntrlIcon = document.getElementById("cntrlIcon")
    var musicaAtual = 0;
    var idUsuario = sessionStorage.ID_USUARIO
    console.log(idUsuario)

    song.onloadedmetadata = function(){
        progress.max = song.duration
        progress.value = song.currentTime
    }

    function iniciar(){
        if(listened){
            song.pause();
            alert("Você já escutou, tente advinhar a música")
        }
        else{
        if(cntrlIcon.src == "assets/play-solid.svg"){
            cntrlIcon.src = "assets/pause-solid.svg"
            song.pause()
        }
        else{
             cntrlIcon.src = "assets/play-solid.svg"
             song.play()
             listened = true
        }
    }
    }

    if(song.play()){
        setInterval(()=>{
            progress.value = song.currentTime
        }, 500)
    }

    progress.onchange = function(){
        song.play()
        song.currentTime = progress.value
    }

    function pausar() {
    }
    function advinhar(){
        tentativas += 1;
        let trys = document.getElementsByClassName("try-box");
        if(iptResposta.value == vtMusicas[musicaAtual][0]){
            alert("Resposta correta")
            nomeMusica.innerHTML = vtMusicas[musicaAtual][0];
            imgMusica.src = vtMusicas[musicaAtual][1];    
            vtTentativas[tentativas] += 1;
            console.log(vtTentativas)
            tentativas = -1;
            musicaAtual += 1;
            song.src = vtMusicas[musicaAtual][2];
            listened = false;

        }
        else{
            alert("Resposta incorreta")
        }
    }

    function finalizar() {
         fetch("/quiz/pontuacao", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        tntv1Server: vtTentativas[0],
        tntv2Server: vtTentativas[1],
        tntv3Server:vtTentativas[2],
        tntv4Server: vtTentativas[3],
        tntv5Server: vtTentativas[4],
        idServer: idUsuario
        /*naoRespondidosServer: naoRespondidosVar,
        seqAcertosServer: seqAcertosVar,
        errosTotaisServer: ErrosTotaisVar*/
      }),
    })}

    function pularSegundos(){
        listened = false;
    }

</script>
</html>